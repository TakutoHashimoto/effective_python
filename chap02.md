# リストと辞書
## 11. シーケンスをどのようにスライスするか知っておく
### Summary
* スライスでは冗長を避ける。インデックスの `start` に0を指定したり、`end` に列長を指定したりしない。
* スライスでは、境界外のインデックスの `start` や `end` が許され、（`a[:20]` や `a[*20:]` のように）シーケンスの前後境界のスライスが簡単に表現できる。
* リストのスライスへの代入では、元のシーケンスの指定範囲が、たとえ長さが違っていても参照されているもので置き換えられる。


## 12. 1つの式では、ストライドとスライスを同時に使わない
### Summary
* スライスでは、`start`、`end`、`stride` を全て指定すると、非常に読みにくい。
* スライスでは、正の増分値を `start` や `end` のどちらか一方のみと使う。可能な限り、負の増分は使わない。
* 1つのスライスに `start`、`end`、`stride` を一緒に使わない。3つ全てが必要なときには、`itertools` の `islice` を使う。


## 13. スライスではなく `catch-all` アンパックを使う
### Summary
* 代入のアンパックでアスタリスク付きの式を使い、アンパックするパターンの残りをまとめてリストにできる。
* アスタリスク付きの式はどこにでも書くことができ、常に受け取る値のリストになる。
* リストを重複のないように分割する場合、`catch-all` アンパックは、スライスやインデックスを使うよりもエラーを起こす危険が少ない。


## 14. `key` 引数を使い複雑な基準でソートする
### Summary
* `list` 型の `sort` メソッドは、リストの内容を文字列、整数、タプルなどを自然な順序で並べ替えるのに使う。
* `sort` メソッドは、特殊メソッドを使って順序付けするメソッドを定義しないとオブジェクトで動作しないが、それは一般的にはあまりない。
* `sort` メソッドの `key` パラメータを使い、`list` の各要素をソートする値を返すヘルパー関数を与えることができる。
* `key` 関数でタプルを返すことにより、複数のソート基準を組み合わせることができる。単項マイナス演算子が、その型で許されるソート順を逆転するのに使える。
* マイナス演算子を使えない型では、`sort` メソッドをさまざまな `key` 関数と `reverse` 値に対して、最も低いランクの `sort` 呼び出しから最も高いランクの `sort` 呼び出しまで順に複数回呼び出すことで組み合わせの高いソートができる。


## 15. `dict` の挿入順序に依存する場合は注意する
### Summary
* Python3.7以降は、`dict` インスタンスの内容をイテレーションすると、キーが最初に挿入された順番に保存される。
* Pythonでは、`dict` インスタンスではないが辞書のように振る舞うオブジェクトを簡単に定義できる。そのような型では、挿入順序が保持されると仮定できない。
* 辞書的クラスで注意するには3通りの方法がある。
  * 挿入順序に依存しないコードを書く。
  * 実行時に `dict` 型か明示的にチェックする。
  * 型ヒントと静的解析を使って `dict` 値の要件をチェックする。


## 16. 辞書の欠損キーの処理には `in` や `KeyError` ではなく `get` を使う
### Summary
* 辞書の欠損キーを検出するには次の4つの方法がある。
  * `in` 式
  * `KeyError` 例外
  * `get` メソッド
  * `setdefault` メソッド
* `get` メソッドは、カウンタのような基本的な型からなる辞書に最適だ。辞書の値の生成コストがかかる場合や例外が送出される可能性がある場合は代入式と一緒に使うのが好ましい。
* 問題を解決するために `dict` の `setdefault` が最良と思われる場合には、代わりに `defaultdict` を使うことを検討する。


## 17. 内部状態の欠損状態を扱うには `setdefault` ではなく `defaultdict` を使う
### Summary
* 辞書を使って任意のキー集合を処理するなら、問題に適しているなら組み込みモジュール `collections` の `defaultdict` インスタンスを使うべきだ。
* 辞書のキーを指定され、その辞書を自分で作成できない状況なら、`get` を使って要素にアクセスしよう。しかし、それより短いコードになる `setdefault` メソッドの使用を検討する状況もあるだろう。


## 18. `__missing__` でキー依存デフォルト値を作成する方法を把握しておく
### Summary
* `dict` の `setdefault` メソッドは、デフォルト値作成が高コストだったり例外が発生するような場合には使うべきではない。
* `defaultdict` に渡される関数には引数が渡せず、アクセスできるキーに依存できるデフォルト値が使えない。
* メソッド `__missing__` を持つ `dict` サブクラスを定義して、どのキーをアクセスしているかがわかるデフォルト値を作ることができる。
